<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alterar Login ‚Äî Perfil</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    /* =========================
       VARI√ÅVEIS DE COR (tema)
       ========================= */
    /* ==================================================
   TEMAS ‚Äî CORES ALEAT√ìRIAS (modifique depois)
   ================================================== */

    /* Tema Claro */
    body.theme-light {
      --bg: #f5f7fb;
      --card: #ffffff;
      --accent: #bd467f;
      --muted: #6c6f8a;
      --success: #16a34a;
      --danger: #ef4444;
      --text: #0f172a;
      --input-bg: #ffffff;
      --input-border: #e7e9f2;
      --panel-grad: #f3f3f7;
    }

    /* Tema Escuro */
    body.theme-dark {
      --bg: #0d0f17;
      --card: #141621;
      --accent: #bd467f;
      --muted: #9ca3af;
      --success: #22c55e;
      --danger: #f87171;
      --text: black;
      --input-bg: #1a1d29;
      --input-border: #bd467f;
      --panel-grad: black;
      --button-ghost: white;

    h2{
      color: #bd467f;
    }

    }

    /* Tema Dalt√¥nico Claro */
    body.theme-daltonic-light {
      --bg: #f4faf6;
      --card: #ffffff;
      --accent: #FF00FF;
      --muted: #4f6a65;
      --success: #16a34a;
      --danger: #ef4444;
      --text: #0a2316;
      --input-bg: #ffffff;
      --input-border: #ffc107;
      --panel-grad: #f0f0f0;

    h2{
      color: black;
    }

     .choose-avatar-link{
      color: #FF00FF;
     }

    }

    /* Tema Dalt√¥nico Escuro */
    body.theme-daltonic-dark {
      --bg: #000000;
      --card: #000000;
      --accent: #FF00FF;
      --muted: white;
      --success: #22c55e;
      --danger: #f87171;
      --text: black;
      --input-bg: #10201c;
      --text-card: #ffffff;
      --input-border: #ffc107;
      --panel-grad: black;
      --button-ghost: white;

      
    h2{
      color: #FF00FF;
    }

     .choose-avatar-link{
      color: #FF00FF;
     }

.profile-dropdown {
  display: none;
  position: absolute;
  background: var(--card);
  right: 0;
  top: 60px;
  min-width: 160px;
  border: 1px solid var(--input-border);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  flex-direction: column;
  z-index: 1000;
}

.profile-dropdown a {
  padding: 10px;
  text-decoration: none;
  color: var(--text);
  font-family: "Poppins", sans-serif;
}

.profile-dropdown a:hover {
  background: var(--input-bg);
}



    }


    /* Fonte global ‚Äî mant√©m suas fontes */
    :root {
      font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    /* =========================
       ESTILOS ORIGINAIS (mantive tudo)
       ========================= */

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, #eaf2fb 0%, var(--bg) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      color: var(--text);
      transition: background .25s ease, color .25s ease;
    }



    .card {
      width: 100%;
      max-width: 920px;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(16, 90, 159, 0.08);
      display: grid;
      grid-template-columns: 360px 1fr;
      overflow: hidden;
      transition: background .25s ease, box-shadow .25s ease;
    }

    .panel {
      padding: 28px;
      background: var(--panel-grad);
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: background .25s ease;
    }

    .avatar {
      width: 120px;
      height: 120px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #09326a;
      font-size: 40px;
      background: #ccc;
      background-size: cover;
      background-position: center;
      border: 5px solid var(--accent);
      box-shadow: none;
      transition: border .25s ease, background .25s ease;
    }

    .panel h2 {
      margin: 0;
      font-size: 20px
    }

    h2{
      color: #4d535c;
    }

    .panel p {
      margin: 0;
      color: var(--muted);
      font-size: 14px
    }

    form {
      padding: 28px 36px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .row {
      display: flex;
      gap: 12px
    }

    .col {
      flex: 1;
      min-width: 0
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="file"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      font-size: 14px;
      outline: none;
      transition: all .15s ease;
      color: var(--text);
    }

    input:focus {
      box-shadow: 0 4px 12px rgba(16, 90, 159, 0.06);
      border-color: var(--accent)
    }

    .help {
      font-size: 12px;
      color: var(--muted)
    }

    .btn-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 6px
    }

    button {
      cursor: pointer;
      border: 0;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600
    }

    .btn-primary {
      background: var(--accent);
      color: black
    }

    .btn-ghost {
      background: transparent;
      border: 2px solid var(--input-border) !important;
      color: var(--button-ghost) !important;
    }

    .small {
      font-size: 13px;
      color: var(--muted)
    }

    .status {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 8px
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px
    }

    .dot.success {
      background: var(--success)
    }

    .dot.warn {
      background: #f59e0b
    }

    .dot.danger {
      background: var(--danger)
    }

    .meta {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted)
    }

    @media(max-width:820px) {
      .card {
        grid-template-columns: 1fr;
      }

      .panel {
        padding: 22px
      }

      form {
        padding: 22px
      }
    }

    .toast {
      position: fixed;
      right: 20px;
      bottom: 20px;
      padding: 12px 16px;
      background: #08132a;
      color: white;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(2, 6, 23, 0.35);
      display: none
    }

    .fade-in {
      animation: fade .32s ease both
    }

    @keyframes fade {
      from {
        opacity: 0;
        transform: translateY(6px)
      }

      to {
        opacity: 1;
        transform: none
      }
    }

    :focus {
      outline: 2px solid rgba(16, 90, 159, 0.18);
      outline-offset: 2px
    }

    button {
      font-family: 'Montserrat', 'Poppins', sans-serif;
      color: black;
    }

    .avatar-field {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .choose-avatar-link {
      font-size: 13px;
      color: #d64c7f;
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
      margin-top: -8px;
    }

    .choose-avatar-link:hover {
      text-decoration: underline;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="file"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #e6e9ef;
      background: #fbfdff;
      font-size: 14px;

      /* üëá NOVA FONTE PARA OS INPUTS */
      font-family: 'Poppins', system-ui, sans-serif;

      outline: none;
      transition: all .15s ease;
    }
  </style>
</head>

<body>

  <main class="card" role="main" aria-labelledby="title">
    <aside class="panel">
      <div class="avatar" id="avatar">ME</div>
      <h2 id="title">Configurar Perfil</h2>
      <p>Altere seu nome de usu√°rio, imagem ou e-mail de login.</p>
      <div class="help">O login ser√° mostrado no cabe√ßalho ap√≥s salvar.</div>
    </aside>

    <form id="form" class="fade-in" aria-describedby="helpText" novalidate>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
        <div>
          <label for="currentLogin">Login atual</label>
          <input id="currentLogin" type="text" value="mariaeduarda" disabled aria-disabled="true">
        </div>
        <div style="text-align:right">
          <label for="previewToggle" style="visibility:hidden">Preview</label>
          <div class="small">Pr√©-visualiza√ß√£o</div>
          <div class="status" aria-hidden="true">
            <div class="dot success" id="previewDot"></div>
            <div class="small" id="previewText">Sem altera√ß√£o</div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="newUsername">Novo login (nome de usu√°rio)</label>
          <input id="newUsername" name="newUsername" type="text" placeholder="ex: maria.eduarda"
            aria-describedby="usernameHelp">
          <div id="usernameHelp" class="help">Somente letras, n√∫meros, pontos. 3‚Äì30 caracteres.</div>
        </div>
        <div class="col">
          <label for="newEmail">Novo e-mail</label>
          <input id="newEmail" name="newEmail" type="email" placeholder="seu@exemplo.com">
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="password">Senha atual</label>
          <input id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="col">
          <label for="confirmPassword">Confirme a senha</label>
          <input id="confirmPassword" name="confirmPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
      </div>

      <div>
        <div class="field-group avatar-field">
          <label for="avatarFile">Alterar foto de perfil (opcional)</label>
          <a href="escolher-avatar.html" class="choose-avatar-link">Ou escolha seu avatar</a>
        </div>

        <input id="avatarFile" type="file" accept="image/*">
        <div class="help">PNG, JPG ou WEBP ‚Äî at√© 2MB. Opcional, apenas para pr√©-visualiza√ß√£o.</div>
      </div>



      <div class="btn-row">
        <a href="index.html" class="btn-ghost" id="cancelBtn"
          style="text-decoration:none;display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid var(--input-border);color:var(--muted);text-align:center;">Cancelar</a>
        <button type="button" class="btn-primary" id="previewBtn">Pr√©-visualizar</button>
        <button type="submit" class="btn-primary" style="background:#ddacfb">Salvar altera√ß√µes</button>
      </div>

      <div class="meta">√öltima altera√ß√£o: <strong id="lastModified"></strong></div>
    </form>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    /* ===============================================
          üîµ APLICA√á√ÉO DO TEMA ‚Äî VERS√ÉO CORRIGIDA
       =============================================== */

    (function applySavedTheme() {
      try {
        let theme = localStorage.getItem("theme");        // "light" | "dark"
        let daltonic = localStorage.getItem("daltonic");  // "on" | "off"

        // garante que tem valor
        if (!theme) theme = "light";

        // monta o tema final
        let finalTheme = theme;

        if (daltonic === "on") {
          finalTheme = `daltonic-${theme}`;
        }

        console.log("Tema final aplicado:", finalTheme);

        // remove todos os temas poss√≠veis
        document.body.classList.remove(
          "theme-light",
          "theme-dark",
          "theme-daltonic-light",
          "theme-daltonic-dark"
        );

        // aplica o tema final
        document.body.classList.add(`theme-${finalTheme}`);

      } catch (err) {
        console.warn("Erro ao aplicar tema:", err);
      }
    })();



    /***********************
     * L√ìGICA DO PERFIL
     ***********************/
    const CURRENT_KEY = "userData";
    let user = null;
    try { user = JSON.parse(localStorage.getItem(CURRENT_KEY)); } catch (e) { user = null; }

    let emailAntigo = user ? user.email : null;

    const currentLogin = document.getElementById("currentLogin");
    const newUsername = document.getElementById("newUsername");
    const newEmail = document.getElementById("newEmail");
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const avatarFile = document.getElementById("avatarFile");
    const avatarPreview = document.getElementById("avatar");
    const previewText = document.getElementById("previewText");
    const previewDot = document.getElementById("previewDot");
    const lastModifiedEl = document.getElementById("lastModified");

    function dataAtualBR() {
      return new Date().toLocaleDateString("pt-BR", {
        day: "2-digit",
        month: "long",
        year: "numeric"
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      if (!user) {
        // se n√£o houver usu√°rio logado, limpa campos e evita erros
        currentLogin.value = "";
        newUsername.value = "";
        newEmail.value = "";
        lastModifiedEl.textContent = "Nenhuma altera√ß√£o registrada";
        return;
      }

      currentLogin.value = user.nome || "";
      newUsername.value = user.nome || "";
      newEmail.value = user.email || "";

      if (user.foto) {
        avatarPreview.textContent = "";
        avatarPreview.style.background = `url('${user.foto}') center/cover no-repeat`;
      } else {
        avatarPreview.style.background = '';
        avatarPreview.textContent = user && user.nome ? user.nome.split(' ').map(n => n[0]).join('') : 'ME';
      }

      lastModifiedEl.textContent = user.ultimaModificacao || "Nenhuma altera√ß√£o registrada";
    });

    // preview da imagem selecionada localmente
    avatarFile.addEventListener("change", () => {
      const file = avatarFile.files && avatarFile.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        avatarPreview.style.background = `url('${reader.result}') center/cover no-repeat`;
        avatarPreview.textContent = "";
      };
      reader.readAsDataURL(file);
    });

    // bot√£o pr√©-visualizar
    const previewBtn = document.getElementById("previewBtn");
    if (previewBtn) {
      previewBtn.addEventListener("click", () => {
        if (!user) {
          previewText.textContent = "Sem usu√°rio";
          previewDot.className = "dot warn";
          return;
        }
        previewText.textContent = "Altera√ß√µes pendentes";
        previewDot.className = "dot warn";
      });
    }

    // submit/form salvar
    const form = document.getElementById("form");
    if (form) {
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!user) { alert("Nenhum usu√°rio encontrado."); return; }

        if (password.value !== confirmPassword.value) {
          alert("As senhas n√£o coincidem.");
          return;
        }

        const novoNome = (newUsername.value || "").trim();
        const novoEmail = (newEmail.value || "").trim();

        if (!novoNome || !novoEmail) {
          alert("Preencha todos os campos obrigat√≥rios.");
          return;
        }

        user.nome = novoNome;
        user.email = novoEmail;
        user.ultimaModificacao = dataAtualBR();

        const file = avatarFile.files && avatarFile.files[0];

        function salvarEAtualizar() {
          try { localStorage.setItem(CURRENT_KEY, JSON.stringify(user)); } catch (e) { console.warn('save user failed', e); }

          // atualizar array de users
          try {
            let allUsers = JSON.parse(localStorage.getItem('users')) || [];
            const index = allUsers.findIndex(u => u.email === emailAntigo);
            if (index !== -1) {
              allUsers[index] = user;
              localStorage.setItem('users', JSON.stringify(allUsers));
            }
          } catch (e) { /* n√£o bloqueia */ }

          alert("Perfil atualizado com sucesso!");
          window.location.href = "index.html";
        }

        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            user.foto = reader.result;
            salvarEAtualizar();
          };
          reader.readAsDataURL(file);
        } else {
          salvarEAtualizar();
        }
      });
    }
  </script>
</body>

</html>