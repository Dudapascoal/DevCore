<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escolher Avatar</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      /* ---- Core (valores base usados quando data-theme="light") ---- */
      --bg: #fafafa;
      --text: #222;
      --card-border: #bd467f;
      --selected-outline: #ddacfb;
      --line: #bd467f;
      --btn-save-bg: #bd467f;
      --btn-back-bg: #e6e6e6;
      --btn-back-text: #333;

      /* Valores de acessibilidade / contraste (padrões) */
      --bg-accent: rgba(16,90,159,0.04);

      /* transições */
      --transition-fast: .18s;
    }

    /* =========================
       TEMA: ESCURO
       ========================= */
    [data-theme="dark"] {
      --bg: #000000;
      --text: #e9e9e9;
      --card-border: #bd467f;        /* borda dos avatares no escuro */
      --selected-outline: #7fbff8;   /* outline seleção no escuro */
      --line: #ddacfb;
      --btn-save-bg: #ddacfb;
      --btn-back-bg: #222831;
      --btn-back-text: #eee;
      --bg-accent: rgba(63,141,204,0.06);
    }

    /* =========================
       TEMA: DALTÔNICO CLARO
       (cores adaptadas para daltônicos — alto contraste e paleta segura)
       ========================= */
    [data-theme="daltonic-light"] {
      --bg: #fbfcfe;
      --text: #111827;
      --card-border: #FF00FF !important;        /* azul primário (substitui rosa) */
      --selected-outline: #a6d1ff;
      --line: #ffc107 !important;
      --btn-save-bg: #ffc107!important;
      --btn-back-bg: #f0f4fb;
      --btn-back-text: #1f2937;
      --bg-accent: rgba(16,90,159,0.06);
    }

    /* =========================
       TEMA: DALTÔNICO ESCURO
       ========================= */
    [data-theme="daltonic-dark"] {
      --bg: #000000;
      --text: #e6eef9;
      --card-border:  #FF00FF !important;
      --selected-outline: #ffc107;
      --line:  #ffc107 !important;
      --btn-save-bg:  #ffc107 !important;
      --btn-back-bg: #071425;
      --btn-back-text: #e6eef9;
      --bg-accent: rgba(63,141,204,0.06);
    }

    /* =========================
       ESTILOS GERAIS (mantive seu design)
       ========================= */
    body{
      margin:0;
      font-family:'Poppins', sans-serif;
      background:var(--bg);
      color:var(--text);
      text-align:center;
      padding:20px;
      transition: background var(--transition-fast), color var(--transition-fast);
      
    }

    .no-transition * {
  transition: none !important;
}


    h2{
      margin-top:10px;
      font-size:22px;
    }

    .avatar-preview{
      width:160px;
      height:160px;
      border-radius:100%;
      margin:20px auto 10px;
      border:5px solid var(--card-border);
      background:#ccc;
      background-size:cover;
      background-position:center;
      transition: border var(--transition-fast), box-shadow var(--transition-fast);
    }

    .section-title{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:15px;
      margin-top:40px;
      margin-bottom:20px;
      font-size:20px;
      font-weight:500;
    }

    .section-title .line{
      width:60px;
      height:4px;
      border-radius: 15px;
      background:var(--line);
      transition: background var(--transition-fast);
    }

    .avatar-option{
      width:95px;
      height:95px;
      border-radius:100%;
      border:4px solid var(--card-border);
      cursor:pointer;
      background-size:cover;
      background-position:center;
      transition:transform .2s, border var(--transition-fast);
    }

    .avatar-option:hover{
      transform:scale(1.06);
    }

    .avatar-option.selected{
      outline:4px solid var(--selected-outline);
    }

    .btn-save, .btn-back{
      font-family:'Poppins', sans-serif;
      padding:12px 22px;
      border:none;
      border-radius:20px;
      font-weight:500;
      font-size:16px;
      cursor:pointer;
      margin-top:20px;
      display:inline-block;
      transition: background var(--transition-fast), color var(--transition-fast);
    }

    .btn-save{
      background:var(--btn-save-bg);
      color:black;
      margin-left:10px;
    }

    .btn-back{
      background:var(--btn-back-bg);
      color:var(--btn-back-text);
    }

    .grids-container{
      display:flex;
      justify-content:center;
      gap:5px;
      margin-top:30px;
    }

    .grid-wrapper{
      width:40%;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(4, 95px);
      justify-content:center;
      gap:40px;
      margin-bottom:30px;
    }

    /* pequenos ajustes para garantir legibilidade em temas escuros */
    @media (prefers-color-scheme: dark) {
      /* nada forçado aqui — deixamos o tema controlado por data-theme */
    }
  </style>
</head>
<body>

  <div class="avatar-preview" id="avatarPreview"></div><br>
  <h2>Escolha seu avatar : </h2>

<div class="grids-container">

  <!-- MENINAS -->
  <div class="grid-wrapper">
    <div class="section-title">
      <div class="line"></div>
      Meninas
      <div class="line"></div>
    </div>
    <div class="grid" id="girls"></div>
  </div>

  <!-- MENINOS -->
  <div class="grid-wrapper">
    <div class="section-title">
      <div class="line"></div>
      Meninos
      <div class="line"></div>
    </div>
    <div class="grid" id="boys"></div>
  </div>

</div>

<!-- Botões -->
<div style="margin-top:20px;">
  <button class="btn-back" id="backBtn">Voltar</button>
  <button class="btn-save" id="saveAvatar">Salvar</button>
</div>

<script>
  /***************************************
   * TEMA: suporta 4 valores (persistido)
   * - light
   * - dark
   * - daltonic-light
   * - daltonic-dark
   *
   * Guarda o tema em localStorage key "theme"
   ***************************************/

(function applyThemeFromStorage(){
  const theme = localStorage.getItem("theme") || "light"; // light ou dark
  const daltonic = localStorage.getItem("daltonic");       // on ou off

  let finalTheme = theme; // começa como light/dark

  if (daltonic === "on") {
    finalTheme = theme === "dark" ? "daltonic-dark" : "daltonic-light";
  }

  document.documentElement.setAttribute("data-theme", finalTheme);
})();

  /* função utilitária para alterar tema programaticamente:
     setTheme('dark') ou setTheme('daltonic-light')
     isso salva no localStorage e aplica imediatamente.
  */
  function setTheme(themeName){
    const allowed = ["light","dark","daltonic-light","daltonic-dark"];
    if (!allowed.includes(themeName)) {
      console.warn("Tema inválido:", themeName);
      return;
    }
    localStorage.setItem("theme", themeName);
    document.documentElement.setAttribute("data-theme", themeName);
  }

  // Exemplo de uso (não executa automaticamente):
  // setTheme('daltonic-light');

  /* =========================
        SISTEMA DE AVATARES
     ========================= */
  const DEFAULT_AVATAR = 'avatares/default-avatar.png';

  const girls = [
    'avatares/meninas/Avatar 1.png', 'avatares/meninas/Avatar 2.png', 'avatares/meninas/Avatar 3.png',
    'avatares/meninas/Avatar 4.png', 'avatares/meninas/Avatar 5.png', 'avatares/meninas/Avatar 6.png',
    'avatares/meninas/Avatar 7.png', 'avatares/meninas/Avatar 8.png', 'avatares/meninas/Avatar 9.png',
    'avatares/meninas/Avatar 10.png', 'avatares/meninas/Avatar 11.png', 'avatares/meninas/Avatar 12.png'

  ];

  const boys = [
    'avatares/meninos/Avatar 1.png', 'avatares/meninos/Avatar 2.png', 'avatares/meninos/Avatar 3.png',
    'avatares/meninos/Avatar 4.png', 'avatares/meninos/Avatar 5.png', 'avatares/meninos/Avatar 6.png',
    'avatares/meninos/Avatar 7.png', 'avatares/meninos/Avatar 8.png', 'avatares/meninos/Avatar 9.png',
    'avatares/meninos/Avatar 10.png', 'avatares/meninos/Avatar 11.png', 'avatares/meninos/Avatar 12.png'
  ];

  const girlsContainer = document.getElementById('girls');
  const boysContainer = document.getElementById('boys');
  const avatarPreview = document.getElementById('avatarPreview');

  let user = {};
  try { user = JSON.parse(localStorage.getItem('userData')) || {}; } catch(e){ user = {}; }

  let selectedAvatar = user.foto || DEFAULT_AVATAR;
  avatarPreview.style.backgroundImage = `url('${selectedAvatar}')`;

  function renderAvatars(list, container){
    list.forEach(src => {
      const div = document.createElement('div');
      div.classList.add('avatar-option');
      div.style.backgroundImage = `url('${src}')`;

      if(selectedAvatar === src){
        div.classList.add('selected');
      }

      div.addEventListener('click', () => {
        document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
        div.classList.add('selected');
        selectedAvatar = src;
        avatarPreview.style.backgroundImage = `url('${src}')`;
      });

      container.appendChild(div);
    });
  }

  renderAvatars(girls, girlsContainer);
  renderAvatars(boys, boysContainer);

  document.getElementById('saveAvatar').addEventListener('click', () => {
    if(!selectedAvatar){
      alert('Selecione um avatar primeiro!');
      return;
    }

    try {
      user.foto = selectedAvatar;
      user.ultimaModificacao = new Date().toLocaleDateString('pt-BR', { day:'2-digit', month:'long', year:'numeric' });
      localStorage.setItem('userData', JSON.stringify(user));

      let users = JSON.parse(localStorage.getItem('users')) || [];
      const index = users.findIndex(u => u.email === user.email);
      if(index !== -1){ users[index] = user; }
      localStorage.setItem('users', JSON.stringify(users));
    } catch(e){
      console.warn('Erro ao salvar avatar:', e);
    }

    alert('Avatar atualizado com sucesso!');
    window.location.href = 'configurar-perfil.html';
  });

  document.getElementById('backBtn').addEventListener('click', () => {
    window.location.href = 'configurar-perfil.html';
  });
</script>

</body>
</html>
